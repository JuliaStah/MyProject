function TargetAds(e,t={}){if(!e)throw{name:"TargetAdsInitializationError",message:"projectId is invalid"};"object"!=typeof t&&console.warn("TargetAds: Incorrect type of settings for debug mode",t),this.host=t.host||"https://eye.targetads.io",this.projectId=e,this.storPrefix=`_tads${e}_cid`,this.yandexuidPrefix=`_tads${e}_yandexuid`,this.sessionIdPrefix=`_tads${e}_sid`,this.__debug=t.debug||!1,this.__otrack=t.other_trackers||!0,this.isCheckUtm=t.check_utm||!1,this.__limittime=3e5,this.__timeout=3e4,this.currentUrl=window.location.href,this.isCheckAnchor=t.isCheckLocationAnchor||!1,this.isCheckLocation=t.isCheckLocation||!1,this.isOnlyOneInDay=t.isOnlyOneInDay||!1,this.startSession=0,this.getCid=(()=>{var e;return window.localStorage.getItem(this.storPrefix)?window.localStorage.getItem(this.storPrefix):(e=`TA-${Date.now()}-`+(Math.random()+1).toString(36).substring(4).toUpperCase(),window.localStorage.setItem(this.storPrefix,e),e)}),this.getYandexuid=(()=>{try{if(window.location.href.includes("yandexuid")){var e=new URLSearchParams(window.location.search).get("yandexuid");if(e)return localStorage.setItem(this.yandexuidPrefix,e),e}if(window.localStorage.getItem(this.yandexuidPrefix))return window.localStorage.getItem(this.yandexuidPrefix)}catch(e){return this.log(e),""}}),window._targetADS=this.event.bind(this),this.listenerLocation=(()=>{this.isCheckLocation&&window.addEventListener("popstate",()=>{this.onChangeLocation()})}),this.getSid=(()=>{return window.localStorage.getItem(this.sessionIdPrefix)||""})}TargetAds.prototype.getUserAgent=function(){return window.navigator&&window.navigator.userAgent||""},TargetAds.prototype.log=function(e,t=0){this.__debug&&console.info("TargetAds:"+e)},TargetAds.prototype.sendPixel=function(e){let t=!1,r=1;function i(){t=!0}if(document.createElement&&document.body)try{const s=document.createElement("img"),a=(s.style.position="absolute",s.style.display="none",s.style.width=s.style.height="0px",s.style.display="none",s.referrerPolicy="no-referrer-when-downgrade",s.src=e,document.body.appendChild(s),s.onload=i,setInterval(()=>{t||2<r?clearInterval(a):(s.src=e,r++)},3e3));return s}catch(e){this.log(e)}else try{const s=new Image,a=(s.referrerPolicy="no-referrer-when-downgrade",s.src=e,s.onload=i,setInterval(()=>{t||2<r?clearInterval(a):(s.src=e,r++)},3e3));return s}catch(e){this.log(e)}},TargetAds.prototype.req=async function(e,t,r=0){if(this.log("Sending data: "+t),this.log("Sending query: "+e),r*this.__timeout>=this.__limittime)return this.log("Max retries for: "+t,!0);var i=TargetAdsQueues.peek();TargetAdsQueues.dequeue(i);const s=new AbortController;var a=setTimeout(()=>{s.abort()},this.__timeout);try{var o,n=await fetch(this.host+"/web/collect?"+e,{method:"POST",cache:"no-cache",credentials:"include",headers:{"Content-Type":"text/plain"},referrerPolicy:"no-referrer-when-downgrade",body:t,signal:s.signal});clearTimeout(a),0===TargetAdsQueues.length?localStorage.removeItem(`_tads${this.projectId}_queue`):localStorage.setItem(`_tads${this.projectId}_queue`,JSON.stringify(TargetAdsQueues)),200===n.status||204===n.status?(this.log("Data was send"),(o=await n.text())&&!isNaN(Number(o))&&window.localStorage.setItem(this.storPrefix,o)):(TargetAdsQueues.enqueue(i),setTimeout(()=>{this.req(e,t,r+1)},this.__timeout),this.log(`Data wasn't send. Status code is ${n.status}. Response text `+n.body,!0))}catch(s){clearTimeout(a),"AbortError"===s.name?this.log(`Request timeout after ${this.__timeout}ms`,!0):this.log(s,!0),TargetAdsQueues.enqueue(i),setTimeout(()=>{this.req(e,t,r+1)},this.__timeout)}},TargetAds.prototype.getOtherCounters=function(){var e;return this.__otrack?TargetAdsIsCookiesAvailable()?{ycid:(e=document.cookie.match("(?:^|;)\\s*_ym_uid=([^;]*)"))?decodeURIComponent(e[1]):"",gcid:(e=document.cookie.match("(?:^|;)\\s*_ga=([^;]*)"))?decodeURIComponent(e[1]):""}:(this.log("Cookies are not available",!0),{ycid:"",gcid:""}):{}},TargetAds.prototype.waitForYandexCounter=function(e=7,t=300){return new Promise(r=>{if(this.__otrack)if(TargetAdsIsCookiesAvailable()){let i=0;const s=()=>{document.cookie.match("(?:^|;)\\s*_ym_uid=([^;]*)")?r(!0):++i>=e?r(!1):setTimeout(s,t)};s()}else this.log("Cookies are not available",!0),r(!1);else r(!1)})},TargetAds.prototype.defaultParams=function(){return{dl:this.convertToString(document.location.href),ref:this.convertToString(document.referrer),ul:this.convertToString(window.navigator.language.toLowerCase()),ww:this.convertToString(window.screen.availWidth),wh:this.convertToString(window.screen.availHeight),dt:this.convertToString(document.title),pid:this.convertToString(this.projectId),cid:this.getCid(),yandexuid:this.convertToString(this.getYandexuid())}},TargetAds.prototype.convertToString=function(e){if((e||0===e)&&"object"!=typeof e)try{return String(e)}catch(e){}return""},TargetAds.prototype.isValidString=function(e){return null!=e&&""!==(e=String(e)).trim()&&!["null","undefined","nan","n/a","not applicable","none"].includes(e.toLowerCase())},TargetAds.prototype.convertToNumber=function(e){try{var t;return e===1/0||e===-1/0?0:(t=Number(e),isNaN(t)?0:t)}catch(e){return 0}},TargetAds.prototype.convertToObjectString=function(e,t=0){if(e&&"object"==typeof e)try{const r={};return t?Object.keys(e).slice(0,t).map(t=>r[t]=this.convertToString(e[t])):Object.keys(e).map(t=>r[t]=this.convertToString(e[t])),r}catch(t){}return{}},TargetAds.prototype.getValueOrDefault=function(e,t,r,i){if(e&&"object"==typeof e&&e[t]){if("string"===i&&"object"!=typeof e[t])return this.convertToString(e[t]);if("number"===i)return this.convertToNumber(e[t])}return r},TargetAds.prototype.onChangeLocation=function(){var e=window.location.href;if(((e,t,r=!1)=>{try{var i,s;return/#\/.*/.test(e)&&/#\/.*/.test(t)?(i=e.split("#/")[1],s=t.split("#/")[1],r?i!==s:i.split("#")[0]!==s.split("#")[0]):r?e!==t:e.split("#")[0]!==t.split("#")[0]}catch(e){this.log(e)}return!1})(this.currentUrl,e,this.isCheckAnchor))return this.event("page_view"),this.currentUrl=e},TargetAds.prototype.prepaidEcomData=function(e,t){var r={};if("purchase"===e){if(!t.hasOwnProperty("id")||"object"!=typeof t.items||t.items.length<1)return this.log("Purchase id and items is required",!0),-1;r.ecommerce={type:e,id:this.getValueOrDefault(t,"id","","string"),quantity:this.getValueOrDefault(t,"quantity",0,"number"),amount:this.getValueOrDefault(t,"amount",0,"number")},r.ecommerce_items={id:[],title:[],category1:[],category2:[],brand:[],variant:[],quantity:[],price:[]};for(const e of t.items)e.hasOwnProperty("id")||e.hasOwnProperty("title")?""===this.convertToString(e.id)&&""===this.convertToString(e.title)?this.log("Product adding error. Name or id incorrect",!0):(r.ecommerce_items.id.push(this.getValueOrDefault(e,"id","","string")),r.ecommerce_items.title.push(this.getValueOrDefault(e,"title","","string")),r.ecommerce_items.category1.push(this.getValueOrDefault(e,"category1","","string")),r.ecommerce_items.category2.push(this.getValueOrDefault(e,"category2","","string")),r.ecommerce_items.brand.push(this.getValueOrDefault(e,"brand","","string")),r.ecommerce_items.variant.push(this.getValueOrDefault(e,"variant","","string")),r.ecommerce_items.quantity.push(this.getValueOrDefault(e,"quantity",0,"number")),r.ecommerce_items.price.push(this.getValueOrDefault(e,"price",0,"number"))):this.log("Product adding error. Name or id is required",!0);if(0===r.ecommerce_items.id.length||0===r.ecommerce_items.title.length)return this.log("Items must not be empty"),-1}else{if(!t.hasOwnProperty("id")&&!t.hasOwnProperty("title"))return this.log("Item name or id is required"),-1;if(""===this.convertToString(t.id)&&""===this.convertToString(t.title))return this.log("Item name or id incorrect",!0),-1;r.ecommerce_items={id:[this.getValueOrDefault(t,"id","","string")],title:[this.getValueOrDefault(t,"title","","string")],category1:[this.getValueOrDefault(t,"category1","","string")],category2:[this.getValueOrDefault(t,"category2","","string")],brand:[this.getValueOrDefault(t,"brand","","string")],variant:[this.getValueOrDefault(t,"variant","","string")],quantity:[1],price:[this.getValueOrDefault(t,"price",0,"number")]}}return r},TargetAds.prototype.event=function(e,t={}){if(e.constructor!==String)return o=TargetAdsQueues.peek(),TargetAdsQueues.dequeue(o),this.log(`Name of invalid type - ${typeof e}. Should be String`,!0);this.__debug&&(this.log(`Data for send: ${e}; `+JSON.stringify(t)),this.log("State: "+localStorage.getItem("_tads_init")));let r={};if(window.localStorage.getItem("_tads_uid")&&(r.uid=window.localStorage.getItem("_tads_uid")),"page_view"===e){if("object"==typeof t&&0<Object.entries(t).length&&!Array.isArray(t)){var i,s={};for(i in t)s[i]=t[i];s.user&&"object"==typeof s.user&&!Array.isArray(s.user)?(r.cp={},s.user.hasOwnProperty("uid")?(this.isValidString(this.convertToString(s.user.uid))?(r.uid=this.convertToString(s.user.uid),window.localStorage.setItem("_tads_uid",r.uid)):this.log("TargetAds: incorrect uid argument",!0),delete s.user.uid):this.log("TargetAds: uid argument not found",!0),r.cp=Object.assign(r.cp||{},this.convertToObjectString(s.user,5)),delete s.user):this.log("TargetAds: user object and his uid argument not found",!0),s.event_params&&"object"==typeof s.event_params&&!Array.isArray(s.event_params)&&(s.event_params.hasOwnProperty("uid")?(this.isValidString(this.convertToString(s.event_params.uid))?(r.uid=this.convertToString(s.event_params.uid),window.localStorage.setItem("_tads_uid",r.uid)):this.log("TargetAds: incorrect uid argument",!0),delete s.event_params.uid):this.log("TargetAds: uid argument not found",!0),r.cp=this.convertToObjectString(Object.assign(r.cp||{},s.event_params),5),delete s.event_params),r.cp&&r.cp.hasOwnProperty("uid")&&delete r.cp.uid}function a(e){var t=JSON.stringify(e);let r=0;for(let e=0;e<t.length;e++){r=(r<<5)-r+t.charCodeAt(e),r&=r}return r}var o=this.defaultParams(),n=(e,t=18e5)=>{var r=(new Date).getTime(),i=(i=localStorage.getItem(e))?this.convertToNumber(i):0;return localStorage.setItem(e,""+r),!i||t<r-i?0:1},d=((u=new Date).setHours(0,0,0,0),a({date:u})),u=a({dl:o.dl,cid:o.cid,pid:o.pid,date:u,domain:this.convertToString(document.location.host)}),c=(o="_tads_lt_"+a({pid:o.pid}),localStorage.getItem("_tads_v_"+d));for(let e=0;e<localStorage.length;e++){var g=localStorage.key(e);g.includes("_tads_v_")&&g!=="_tads_v_"+d&&localStorage.removeItem(g)}var l=(e,t)=>{if(t=new RegExp(t+"=([^&]+)"),e=e.match(t))return e[1]};if(n(o)&&c){var h=window.location.href,m={};for(const e of["utm_medium","utm_source","utm_campaign","utm_term","yclid"]){var p=l(h,e);p&&(m[e]=p)}if(Object.keys(m).length&&this.isCheckUtm)if((n=JSON.parse(c)).includes(u)){if(this.startSession=0,this.isOnlyOneInDay)return _=TargetAdsQueues.peek(),void TargetAdsQueues.dequeue(_)}else{10===n.length&&n.shift(),this.startSession=1;var _=a(`${this.projectId}_${this.getCid()}_${this.getUserAgent()}_`+(new Date).getTime());localStorage.setItem(this.sessionIdPrefix,String(_)),n.push(u),localStorage.setItem("_tads_v_"+d,JSON.stringify(n))}else if(this.startSession=0,this.isOnlyOneInDay)return _=TargetAdsQueues.peek(),void TargetAdsQueues.dequeue(_)}else{if(this.startSession=1,n=a(`${this.projectId}_${this.getCid()}_${this.getUserAgent()}_`+(new Date).getTime()),localStorage.setItem(this.sessionIdPrefix,String(n)),c&&this.isOnlyOneInDay)return _=TargetAdsQueues.peek(),void TargetAdsQueues.dequeue(_);localStorage.setItem("_tads_v_"+d,JSON.stringify([u])),localStorage.setItem(o,""+(new Date).getTime())}c=l(n=window.location.href,"pl"),_=l(n,"cn"),u=l(n,"tclick");this.convertToNumber(c)&&this.convertToNumber(_)&&u&&(r.cn=this.convertToNumber(_),r.pl=this.convertToNumber(c),r.tclick=u),r.event_name="page_view";const e=()=>{"object"==typeof r.cp&&r.cp.hasOwnProperty("uid")&&!this.isValidString(this.convertToString(r.cp.uid))&&(this.log("TargetAds: incorrect uid argument in event_params",!0),delete r.cp.uid),Object.assign(r,this.getOtherCounters());var e=Object.assign(this.defaultParams(),{edttm:Math.floor(Date.now()/1e3),sid:this.getSid()}),t={ss:this.startSession};e=Object.assign(e,t),t=new URLSearchParams(e).toString();try{var i=JSON.stringify(r);this.req(t,i).catch(e=>this.log(e,!0))}catch(e){return this.log("Can not send data: "+e,!0)}};if(this.__otrack&&1===this.startSession){const t=TargetAdsQueues.peek();return TargetAdsQueues.dequeue(t),void this.waitForYandexCounter().then(()=>{TargetAdsQueues.enqueue(t),e()})}e()}else{if("event"===e&&t&&0<Object.entries(t).length&&!Array.isArray(t)){var f,v={};for(f in t)v[f]=t[f];if(window.localStorage.getItem("_tads_uid")&&(r.uid=window.localStorage.getItem("_tads_uid")),v.user&&"object"==typeof v.user&&!Array.isArray(v.user)?(r.cp={},v.user.hasOwnProperty("uid")?(this.isValidString(this.convertToString(v.user.uid))?(r.uid=this.convertToString(v.user.uid),window.localStorage.setItem("_tads_uid",r.uid)):this.log("TargetAds: incorrect uid argument",!0),delete v.user.uid):this.log("TargetAds: uid argument not found",!0),r.cp=Object.assign(r.cp||{},this.convertToObjectString(v.user,5)),delete v.user):this.log("TargetAds: user object and his uid argument not found (an optional parameter)",!0),!v.event_name||""===this.convertToString(v.event_name))return o=TargetAdsQueues.peek(),TargetAdsQueues.dequeue(o),this.log("TargetAds: Check the event data",!0);r.event_type=this.convertToString(v.event_type),r.event_category=this.convertToString(v.event_category),r.event_name=this.convertToString(v.event_name),r.event_value=this.convertToNumber(v.event_value),v.event_params&&"object"==typeof v.event_params&&!Array.isArray(v.event_params)&&(v.event_params.hasOwnProperty("uid")?(this.isValidString(this.convertToString(v.event_params.uid))?(r.uid=this.convertToString(v.event_params.uid),window.localStorage.setItem("_tads_uid",r.uid)):this.log("TargetAds: incorrect uid argument",!0),delete v.event_params.uid):this.log("TargetAds: uid argument not found",!0),r.cp=this.convertToObjectString(Object.assign(r.cp||{},v.event_params),5)),r.cp&&r.cp.hasOwnProperty("uid")&&delete r.cp.uid}else if("add_to_cart"===e&&0<Object.entries(t).length&&!Array.isArray(t)){var y,T={};for(y in t)T[y]=t[y];if(r=this.prepaidEcomData(e,t),T.event_params&&"object"==typeof T.event_params&&!Array.isArray(T.event_params)&&(T.event_params.hasOwnProperty("uid")?(this.isValidString(this.convertToString(T.event_params.uid))?(r.uid=this.convertToString(T.event_params.uid),window.localStorage.setItem("_tads_uid",r.uid)):this.log("TargetAds: incorrect uid argument",!0),delete T.event_params.uid):this.log("TargetAds: uid argument not found",!0),r.cp=this.convertToObjectString(Object.assign(r.cp||{},T.event_params),5),delete T.event_params),r.cp&&r.cp.hasOwnProperty("uid")&&delete r.cp.uid,-1===r)return n=TargetAdsQueues.peek(),TargetAdsQueues.dequeue(n),this.log("TargetAds: Check add_to_cart data",!0);r.event_name="add_to_cart"}else{if(!("purchase"===e&&0<Object.entries(t).length)||Array.isArray(t))return _=TargetAdsQueues.peek(),TargetAdsQueues.dequeue(_),this.log("Can not send data",!0);var S,w={};for(S in t)w[S]=t[S];if(r=this.prepaidEcomData(e,t),w.event_params&&"object"==typeof w.event_params&&!Array.isArray(w.event_params)&&(w.event_params.hasOwnProperty("uid")?(this.isValidString(this.convertToString(w.event_params.uid))?(r.uid=this.convertToString(w.event_params.uid),window.localStorage.setItem("_tads_uid",r.uid)):this.log("TargetAds: incorrect uid argument",!0),delete w.event_params.uid):this.log("TargetAds: uid argument not found",!0),r.cp=this.convertToObjectString(Object.assign(r.cp||{},w.event_params),5),delete w.event_params),r.cp&&r.cp.hasOwnProperty("uid")&&delete r.cp.uid,-1===r)return c=TargetAdsQueues.peek(),TargetAdsQueues.dequeue(c),this.log("TargetAds: Check purchase data",!0);r.event_name="purchase"}"object"!=typeof r.cp||!r.cp.hasOwnProperty("uid")||this.isValidString(this.convertToString(r.cp.uid))||(this.log("TargetAds: incorrect uid argument in event_params",!0),delete r.cp.uid),Object.assign(r,this.getOtherCounters());let s=Object.assign(this.defaultParams(),{edttm:Math.floor(Date.now()/1e3),sid:this.getSid()});"page_view"===r.event_name&&(u={ss:this.startSession},s=Object.assign(s,u)),o=new URLSearchParams(s).toString();try{var A=JSON.stringify(r);this.req(o,A).catch(e=>this.log(e,!0))}catch(i){return this.log("Can not send data: "+i,!0)}}};class TargetAdsQueue{constructor(e={},t=0,r=0){this.elements=e,this.head=t,this.tail=r}enqueue(e){this.elements[this.tail]=e,this.tail++}dequeue(){var e=this.elements[this.head];return delete this.elements[this.head],this.head++,e}peek(){return this.elements[this.head]}get length(){return this.tail-this.head}get isEmpty(){return 0===this.length}}const TargetAdsQueues=new TargetAdsQueue,onHandlerEvent=(e=[])=>{try{if(0<e.length){if("init"===e[0])return 1<e.length&&isNaN(e[1])?(console.log("State: "+JSON.stringify([...e].slice(1))),void console.warn("The ID of the TargetAds project is incorrect")):void localStorage.setItem("_tads_init",JSON.stringify([...e].slice(1).map(e=>e)));var t,r=JSON.parse(localStorage.getItem("_tads_init"));r&&0<r.length?(t=r[0],TargetAdsQueues.enqueue(e),localStorage.setItem(`_tads${t}_queue`,JSON.stringify(TargetAdsQueues))):(console.log("State: "+localStorage.getItem("_tads_init")),console.log("Error: First perform initialization TargetAds"))}var i,s;localStorage.getItem("_tads_init")&&(new TargetAds((i=JSON.parse(localStorage.getItem("_tads_init")))[0],i[1]).listenerLocation(),0<TargetAdsQueues.length?"object"==typeof(s=TargetAdsQueues.peek())&&0<s.length?window._targetADS(s[0],s[1]):i&&1<i.length&&i[1]&&console.log("Error: TargetAds Queue item is empty"):i&&1<i.length&&i[1]&&console.log("Error: TargetAds Queue is empty"))}catch(e){console.error("[TargetAds Error]: ",e)}};function TargetAdsIsStorageAvailable(){if("localStorage"in window||"object"==typeof localStorage){var e="TargetADSTest";try{return localStorage.setItem(e,e),"TargetADSTest"===localStorage.getItem(e)&&(localStorage.removeItem(e),!0)}catch(e){}}return!1}function TargetAdsIsCookiesAvailable(){if("undefined"==typeof navigator)return!1;if("boolean"==typeof navigator.cookieEnabled)return navigator.cookieEnabled;try{document.cookie="TargetAdsTest=1";var e=-1!==document.cookie.indexOf("TargetAdsTest=1");return document.cookie="TargetAdsTest=1; expires=Thu, 01 Jan 1970 00:00:00 GMT",e}catch(e){return!1}}"undefined"==typeof window||TargetAdsIsStorageAvailable()||console.log("TargetAds: LocalStorage unavailable"),"undefined"==typeof window||"undefined"==typeof navigator||TargetAdsIsCookiesAvailable()||console.log("TargetAds: Cookies unavailable");try{if(localStorage.getItem("_tads_init")){const e=JSON.parse(localStorage.getItem("_tads_init"));if(localStorage.getItem(`_tads${e[0]}_queue`)){const t=JSON.parse(localStorage.getItem(`_tads${e[0]}_queue`)),r=(localStorage.removeItem(`_tads${e[0]}_queue`),new TargetAdsQueue(t.elements,t.head,t.tail));for(let t of Object.values(r.elements))new TargetAds(e[0],e[1]),window._targetADS(t[0],t[1])}}}catch(e){console.error("[TargetAds Error]: ",e)}const _targetadsGetId=()=>{try{var e,t,r=localStorage.getItem("_tads_init"),i=JSON.parse(r);if(i&&i[0])return e=`_tads${i[0]}_cid`,(t=window.localStorage.getItem(e))&&!isNaN(Number(t))?t:""}catch(e){return А,""}};if(window.targetAdsDataLayer=new Proxy([],{set:function(e,t,r){try{return"data"===t&&(onHandlerEvent(r),!0)}catch(e){return console.error("[TargetAds Error]: ",e),!1}}}),"undefined"!=typeof window&&window.history&&"function"==typeof window.history.pushState&&window.history.state){let e=window.history.state,t=window.location.href;const r=setInterval(function(){var i;localStorage.getItem("_tads_init")&&("object"==typeof(i=JSON.parse(localStorage.getItem("_tads_init")))[1]&&i[1].isCheckLocation?window.history.state!==e&&(e=window.history.state,(i=new TargetAds(i[0],i[1])).currentUrl=t,i=i.onChangeLocation())&&(t=i):clearInterval(r))},2e3)}